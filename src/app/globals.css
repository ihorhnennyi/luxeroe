:root {
  --leaf-count: 18;
  --leaf-grad-a: #c27b1e;
  --leaf-grad-b: #8f4d0b;
}

/* 1) Базовый фон — без fixed */
body {
  background: #fff8ee; /* базовый цвет вместо fixed градиентов */
  color-scheme: light;
}

/* 1.1) Фиксированный градиентный слой через ::after (дешевле) */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  /* те же градиенты, что были на body */
  background: radial-gradient(1000px 600px at 10% 0%, rgba(242, 193, 78, 0.15), transparent 70%),
    radial-gradient(900px 500px at 100% 10%, rgba(183, 92, 54, 0.12), transparent 70%),
    linear-gradient(180deg, #fff8ee 0%, #fff4e3 60%, #fffcf8 100%);
  will-change: transform;
  transform: translateZ(0);
}

/* 2) Шумовой слой — без blend и с более крупным шагом */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  background-image: radial-gradient(rgba(255, 255, 255, 0.22) 1px, transparent 1px);
  background-size: 4px 4px; /* было 2px: дорого */
  opacity: 0.18; /* без mix-blend-mode */
  z-index: 1;
  will-change: opacity;
  transform: translateZ(0);
}

html,
body {
  scroll-behavior: smooth;
  overscroll-behavior: none;
  -webkit-overflow-scrolling: touch;
}

html {
  overflow-y: scroll;
}

.app-shell {
  min-height: 100dvh;
  padding-left: env(safe-area-inset-left, 0);
  padding-right: env(safe-area-inset-right, 0);
  position: relative; /* чтобы слои были позади */
  z-index: 2;
}

@media (max-width: 600px) {
  main {
    overflow-x: clip;
  }
}

/* 3) Слой листьев */
.leaves {
  pointer-events: none;
  position: fixed;
  inset: 0;
  overflow: hidden;
  z-index: 10;
  contain: paint; /* изолируем перерисовку */
}

/* 4) Лист — только transform (одна композиция), без blur */
.leaf {
  position: absolute;
  top: -12vh;
  left: 0;
  width: var(--size, 16px);
  height: var(--size, 16px);
  opacity: var(--opacity, 0.95);
  background: radial-gradient(var(--leaf-grad-a), var(--leaf-grad-b));
  border-radius: 2px 50% 50% 50%;

  /* лёгкая тень вместо drop-shadow + blur */
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.18);

  will-change: transform;
  backface-visibility: hidden;
  transform-style: preserve-3d;

  /* объединяем всё в один transform через анимируемые переменные */
  --sx: 0px; /* горизонтальный сдвиг от качания */
  --ty: -12vh; /* вертикальное падение */
  --rz: 0deg; /* оборот вокруг Z */
  transform: translate3d(var(--sx), var(--ty), 0) rotate(var(--rot, 0deg)) rotateZ(var(--rz))
    scale(var(--scale, 1)) scaleX(var(--flip, 1));

  animation: leaf-fall var(--dur, 10s) linear var(--delay, 0s) infinite,
    leaf-sway calc(var(--dur, 10s) * 0.45) ease-in-out var(--delay, 0s) infinite alternate;
}

/* 4.1) Падение + поворот — меняем только переменные */
@keyframes leaf-fall {
  from {
    --ty: -12vh;
    --rz: 0deg;
  }
  to {
    --ty: 120vh;
    --rz: 360deg;
  }
}

/* 4.2) Качание — меняем только горизонтальную переменную */
@keyframes leaf-sway {
  from {
    --sx: calc(var(--sway, 30px) * -1);
  }
  to {
    --sx: var(--sway, 30px);
  }
}

/* Опциональный вариант с картинкой */
.leaf.leaf--img {
  background: none;
  background-image: var(--img, none);
  background-size: contain;
  background-repeat: no-repeat;
  width: var(--size, 22px);
  height: var(--size, 22px);
}

/* Глубина — без blur */
.leaf:nth-child(3n) {
  --scale: 0.85;
  --sway: 22px;
}
.leaf:nth-child(3n + 1) {
  --scale: 1;
  --sway: 30px;
}
.leaf:nth-child(3n + 2) {
  --scale: 1.15;
  --sway: 38px;
}

@media (prefers-reduced-motion: reduce) {
  .leaf {
    animation: none !important;
    opacity: 0.8;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.12);
  }
}
